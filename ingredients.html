<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Campus Bite ‚Äì Meal Details</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<meta name="theme-color" content="#ff914d">
<link rel="icon" href="images/tent.jpeg" type="image/jpeg">
  <link rel="shortcut icon" href="images/tent.jpeg" type="image/jpeg">
  <!-- Apple / iOS icon (optional but good) -->
  <link rel="apple-touch-icon" href="images/tent.jpeg">
<style>
body{font-family:"Poppins",sans-serif;margin:0;padding:0;background-size:cover;background-position:center;background-repeat:no-repeat;color:#fff;min-height:100vh;display:flex;flex-direction:column;position:relative;}
#overlay{background:rgba(0,0,0,0.5);flex:1;padding:20px;overflow-y:auto;}
header{text-align:center;padding:20px;}
header h1{font-size:1.3rem;font-weight:600;margin:0;color:#ff914d;}
main{max-width:700px;margin:0 auto;}
.meal-details{background:rgba(255,255,255,0.95);color:#333;border-radius:12px;padding:20px;box-shadow:0 4px 16px rgba(0,0,0,0.3);margin-bottom:20px;}
.meal-details h2{color:#ff6a00;margin-bottom:10px;}
.meal-details h3{margin-top:15px;margin-bottom:5px;}
ul, ol{margin-left:20px;}
button{padding:8px 12px;margin:5px;border:none;border-radius:8px;cursor:pointer;transition:0.25s;}
button.favorite{background:#ff7a30;color:#fff;}
button.favorite:hover{background:#ff5400;}
button.share{background:#ffa94d;color:#fff;}
button.share:hover{background:#ff8a00;}
.comments-section{margin-top:25px;}
.comment{background:#f5f5f5;padding:10px;border-radius:8px;margin-bottom:10px;}
.comment strong{color:#ff6a00;}
.comment-form textarea{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #ddd;resize:none;}
.comment-form button{margin-top:8px;background:#ff7a30;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;transition:0.25s;}
.comment-form button:hover{background:#ff5400;}
</style>
</head>
<body id="body">

<div id="overlay">
<header>
  <h1 id="mealTitle">Meal Details üç¥</h1>
  <p class="subtitle">Ingredients and Preparation Steps</p>
</header>

<main id="mealContainer">
  <!-- Selected meal will appear here -->
</main>

<footer>¬© 2025 Campus Bite. Muni University | Arua Uganda</footer>
</div>

<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

<script>
// ---------- Firebase ----------
const firebaseConfig={apiKey:"AIzaSyATGWLqyjWJUaDXwudubIc_Hvh5yPVDyOI",authDomain:"campus-bite-9dbaa.firebaseapp.com",projectId:"campus-bite-9dbaa",storageBucket:"campus-bite-9dbaa.appspot.com",messagingSenderId:"294389261625",appId:"1:294389261625:web:095d6e5f85f4e8"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

const container=document.getElementById("mealContainer");
const body=document.getElementById("body");
const mealTitle=document.getElementById("mealTitle");

// ---------- Meals Data ----------
const meals = [
    {name:"Mandazi", img:"images/mandazi.png", ingredients:["2 cups all-purpose flour","1/2 cup sugar","1 tsp baking powder","1/4 tsp salt","1/2 cup coconut milk or water","Oil for deep frying"], steps:[
      "Combine flour, sugar, baking powder, and salt in a bowl.",
      "Gradually add coconut milk or water and knead to a smooth dough.",
      "Cover and let rest 30 minutes.",
      "Divide into balls, flatten, and heat oil.",
      "Fry until golden brown and serve warm."
    ]},
    {name:"Chapati", img:"images/chapati.jpg", ingredients:["2 cups all-purpose flour","1/2 tsp salt","1/2 cup water","2 tbsp oil"], steps:[
      "Mix flour and salt.",
      "Add water and knead into smooth dough.",
      "Rest for 30 minutes, then divide into balls.",
      "Roll thin circles, cook on hot skillet until golden.",
      "Brush with oil if desired and serve."
    ]},
    {name:"Fried Cassava", img:"images/fried cassava.jpg", ingredients:["500g cassava, peeled","Salt to taste","Oil for frying"], steps:[
      "Peel and cut cassava into sticks or cubes.",
      "Boil until soft, drain and pat dry.",
      "Heat oil and fry until golden.",
      "Drain excess oil and season with salt."
    ]},
    {name:"Pan Cakes", img:"images/pancakes.png", ingredients:["1 cup flour","2 tbsp sugar","1 tsp baking powder","1 cup milk","1 egg","1 tsp vanilla extract","Butter for cooking"], steps:[
      "Mix flour, sugar, and baking powder.",
      "Whisk milk, egg, and vanilla.",
      "Combine wet and dry ingredients.",
      "Cook on greased skillet until golden on both sides.",
      "Serve with syrup or fruits."
    ]},
    {name:"Samosas", img:"images/samosa.jpg", ingredients:["2 cups flour","1/2 tsp salt","Water for dough","Vegetable or meat filling","Oil for frying"], steps:[
      "Make dough from flour, salt, and water.",
      "Prepare filling and cook until done.",
      "Roll dough, cut into halves, fold cones, fill, and seal.",
      "Fry until golden brown and serve."
    ]},
    {name:"Boiled Eggs", img:"images/eggs.jpg", ingredients:["Eggs","Water","Salt (optional)"], steps:[
      "Place eggs in water, bring to boil.",
      "Boil 8-10 mins depending on firmness.",
      "Cool in cold water, peel, and serve."
    ]},
    {name:"Black Tea", img:"images/tea.webp", ingredients:["2 cups water","1 tsp black tea leaves","Sugar or milk optional"], steps:[
      "Boil water, add tea leaves.",
      "Simmer for 2-3 mins, strain into cups.",
      "Add sugar or milk as desired."
    ]},
    {name:"Toasted Bread", img:"images/Bread.jpg", ingredients:["Bread slices","Butter or margarine"], steps:[
      "Heat toaster or pan.",
      "Toast bread slices until golden.",
      "Spread butter and serve."
    ]},
    {name:"Vegetable Samosa (A pair)", img:"images/vegetable.jpg", ingredients:["Samosa pastry","Vegetable filling","Oil for frying"], steps:[
      "Fill pastry with cooked vegetable mix.",
      "Fold into triangles and seal.",
      "Fry until golden brown and crisp."
    ]},
    {name:"Beef Samosa(A pair)", img:"images/beef.png", ingredients:["Samosa pastry","Minced beef filling","Oil for frying"], steps:[
      "Prepare beef filling and cook thoroughly.",
      "Fill pastry, fold into triangles, seal edges.",
      "Fry until golden and serve hot."
    ]},
    {name:"Mandazi (A pair)", img:"images/mandazi.jpg", ingredients:["Dough from Mandazi recipe"], steps:[
      "Take dough, shape into small discs.",
      "Fry in hot oil until golden brown.",
      "Drain and serve warm."
    ]},
    {name:"Beef Pie", img:"images/beef pie.jpg", ingredients:["Pie crust","Minced beef filling","Oil for frying or baking"], steps:[
      "Prepare beef filling with onions and spices.",
      "Fill pie crust, seal edges.",
      "Bake or fry until golden brown."
    ]},
    {name:"Cookies", img:"images/cookies.webp", ingredients:["2 cups flour","1 cup sugar","1/2 cup butter","1 tsp vanilla","1 egg"], steps:[
      "Mix butter and sugar until smooth.",
      "Add egg and vanilla, then flour gradually.",
      "Shape into cookies, bake at 180¬∞C for 10-12 mins."
    ]},
    {name:"Home fries", img:"images/fries.jpg", ingredients:["Potatoes","Oil","Salt and spices"], steps:[
      "Peel and cube potatoes.",
      "Parboil until slightly soft.",
      "Fry until golden, season, and serve."
    ]},
    {name:"Baked Beans", img:"images/beans.jpg", ingredients:["Canned beans","Onions","Tomato paste","Spices"], steps:[
      "Saut√© onions, add tomato paste and spices.",
      "Add beans and simmer 10 mins.",
      "Serve hot."
    ]},
    {name:"Egg Rolls (A pair)", img:"images/egg rolls.jpg", ingredients:["Egg roll pastry","Filling of choice","Oil for frying"], steps:[
      "Prepare filling (vegetables or meat).",
      "Roll filling in pastry, seal edges.",
      "Deep fry until golden and crispy."
    ]},
    {name:"American Pancake", img:"images/american.jpg", ingredients:["1 cup flour","1 tbsp sugar","1 tsp baking powder","1 egg","3/4 cup milk","Butter"], steps:[
      "Mix dry ingredients, then add wet ingredients to form batter.",
      "Cook pancakes on greased skillet until bubbles form and flip.",
      "Serve warm with syrup."
    ]},
    {name:"Kikomando", img:"images/kikomando.jpg", ingredients:["Chapati","Beans","Spices"], steps:[
      "Heat chapati, prepare beans with spices.",
      "Cut chapati into pieces and mix with beans.",
      "Serve warm."
    ]},
    {name:"Fried Rice", img:"images/rice.webp", ingredients:["Rice","Vegetables","Oil","Soy sauce"], steps:[
      "Cook rice and set aside.",
      "Stir fry vegetables in oil, add rice and soy sauce.",
      "Mix well and serve hot."
    ]},
    {name:"Matooke", img:"images/matooke.jpg", ingredients:["Matooke (green bananas)","Salt","Water"], steps:[
      "Peel and mash matooke.",
      "Steam or boil until soft.",
      "Serve with sauce or stew."
    ]},
    {name:"White Rice & Beans", img:"images/white rice.jpg", ingredients:["Rice","Beans","Salt","Oil"], steps:[
      "Cook rice separately.",
      "Cook beans with seasoning.",
      "Serve together hot."
    ]},
    {name:"Anyoya", img:"images/anyoya.jpeg", ingredients:["Maize flour","Water","Salt"], steps:[
      "Mix maize flour with water to form dough.",
      "Cook over medium heat, stirring constantly until firm.",
      "Serve hot."  
    ]},
    {name:"Chicken/Liver/Goat/Beef Stew", img:"images/chicken stew.jpg", ingredients:["Meat of choice","Onions","Tomatoes","Spices","Oil"], steps:[
      "Saut√© onions in oil, add meat and brown.",
      "Add tomatoes and spices, simmer until meat is tender.",
      "Serve hot with rice or bread."
    ]},
    {name:"Cold Water", img:"images/nivana.jpg", ingredients:["Bottled water"], steps:["Serve chilled."]},
    {name:"Fresh Juice", img:"images/juice.jpg", ingredients:["Seasonal fruits","Water","Sugar"], steps:[
      "Wash and cut fruits.",
      "Blend with water and sugar to taste.",
      "Serve chilled."
    ]},{name:"Cold sodas", ingredients:["Carbonated water","Sugar","Flavoring"], steps:[
      "Pour soda into a glass with ice.",
      "Serve chilled."
    ]},
    {name:"Bongo", ingredients:["Carbonated water","Sugar","Flavoring"], steps:[
      "Pour into glass over ice.",
      "Serve immediately."
    ]},
    {name:"Guiness", ingredients:["Guinness beer"], steps:[
      "Pour into glass carefully to maintain head.",
      "Serve chilled."
    ]},
    {name:"Bond 7", ingredients:["Bond 7 beverage"], steps:[
      "Pour over ice if desired.",
      "Serve chilled."
    ]},
    {name:"Smirnoff", ingredients:["Smirnoff vodka"], steps:[
      "Serve chilled or mix with beverage."
    ]},
    {name:"Club Pilsener", ingredients:["Pilsner beer"], steps:[
      "Pour carefully to maintain carbonation.",
      "Serve chilled."
    ]},
    {name:"Minute maid", ingredients:["Fruit juice"], steps:[
      "Pour chilled into glass and serve."
    ]},
    {name:"Bushera", ingredients:["Millet flour","Water","Sugar"], steps:[
      "Mix millet flour with water and sugar.",
      "Boil mixture until thickened.",
      "Serve warm."
    ]},
    {name:"Oner", ingredients:["Oner beverage"], steps:[
      "Serve chilled."
    ]},
    {name:"Yorghurt", ingredients:["Milk","Yogurt culture"], steps:[
      "Mix milk and yogurt culture.",
      "Ferment at warm temperature until thickened.",
      "Serve chilled."
    ]},
    {name:"Fresh Juice", ingredients:["Seasonal fruits","Water","Sugar"], steps:[
      "Wash and cut fruits.",
      "Blend with water and sugar to taste.",
      "Serve chilled."
    ]}
  ];

// ---------- Get selected meal ----------
const params=new URLSearchParams(window.location.search);
const selectedMealName=params.get("meal");

auth.onAuthStateChanged(user=>{
  if(!user){window.location.href="index.html"; return;}
  loadMeal(user);
});

async function loadMeal(user){
  if(!selectedMealName){container.innerHTML="<p>No meal selected. Please go back to Home and select a meal.</p>";return;}
  const meal=meals.find(m=>m.name===selectedMealName);
  if(!meal){container.innerHTML="<p>Meal not found.</p>"; return;}

  // Background
  body.style.backgroundImage=`linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('${meal.img}')`;

  // Meal container
  const div=document.createElement("div");
  div.className="meal-details";
  div.innerHTML=`
    <h2>${meal.name}</h2>
    <div>
      <button class="favorite" id="favoriteBtn">Favorite</button>
      <button class="share" id="shareBtn">Share</button>
    </div>
    <h3>Ingredients:</h3>
    <ul id="ingredientsList">${meal.ingredients.map(i=>`<li><input type="checkbox"> ${i}</li>`).join("")}</ul>
    <h3>Preparation Steps:</h3>
    <ol>${meal.steps.map(s=>`<li>${s}</li>`).join("")}</ol>
    <div class="comments-section">
      <h3>Comments</h3>
      <div id="commentsContainer"></div>
      <form id="commentForm" class="comment-form">
        <textarea id="commentInput" rows="3" placeholder="Add a comment..."></textarea>
        <button type="submit">Post Comment</button>
      </form>
    </div>
  `;
  container.appendChild(div);

  // Favorite button
  document.getElementById("favoriteBtn").addEventListener("click", async()=>{
    await db.collection("users").doc(user.uid).collection("favorites").doc(meal.name).set({mealName:meal.name});
    alert("Added to favorites!");
  });

  // Share button
  document.getElementById("shareBtn").addEventListener("click",()=>{
    navigator.clipboard.writeText(window.location.href);
    alert("Recipe link copied!");
  });

  // Comments
  const commentsContainer=document.getElementById("commentsContainer");
  const commentForm=document.getElementById("commentForm");
  const commentInput=document.getElementById("commentInput");

  commentForm.addEventListener("submit",async(e)=>{
    e.preventDefault();
    const text=commentInput.value.trim();
    if(!text) return;
    await db.collection("meals").doc(meal.name).collection("comments").add({userId:user.uid,text,timestamp:Date.now()});
    commentInput.value="";
  });

  // Load comments in real-time
  db.collection("meals").doc(meal.name).collection("comments").orderBy("timestamp","desc")
    .onSnapshot(snapshot=>{
      commentsContainer.innerHTML="";
      snapshot.forEach(doc=>{
        const data=doc.data();
        const div=document.createElement("div");
        div.className="comment";
        div.innerHTML=`<strong>${data.userId}</strong>: ${data.text}`;
        commentsContainer.appendChild(div);
      });
    });
}
</script>
</body>
</html>
