<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Campus Bite ‚Äì Meals & Budget</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins", sans-serif; }
  body { background:#fff8f1; color:#333; }
  header { background:#ff914d; color:#fff; padding:20px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 4px 8px rgba(0,0,0,0.1);}
  header h1 { font-size:1.3rem; font-weight:600; }
  header button { background:#fff; color:#ff914d; border:none; border-radius:8px; padding:8px 16px; cursor:pointer; font-weight:600; transition:0.3s; }
  header button:hover{ background:#ffd6ba; }

  .filter-section { padding:15px 20px; display:flex; flex-wrap:wrap; align-items:center; gap:10px; }
  .filter-section label { font-weight:600; }
  .filter-section select { padding:5px 8px; border-radius:5px; }

  .meal-section { padding:20px; display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; }
  .meal-card { background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); overflow:hidden; transition:0.3s; }
  .meal-card:hover { transform:scale(1.03); }
  .meal-card img { width:100%; height:150px; object-fit:cover; }
  .meal-info { padding:12px; }
  .meal-info h3 { color:#ff6a00; margin-bottom:5px; font-size:1rem; }
  .meal-info p { font-size:0.85rem; margin-bottom:6px; }
  .meal-info button { background:#ff914d; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; transition:0.3s; font-size:0.85rem;}
  .meal-info button:hover{ background:#ff6a00; }

  .budget-section { background:#fff0e6; padding:20px; text-align:center; border-top:3px solid #ff914d; margin-top:20px; }
  .budget-section h2 { color:#ff6a00; margin-bottom:8px; }
  .budget-section p { font-size:1rem; margin-bottom:8px; }
  .budget-section button { background:#ff914d; color:#fff; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; transition:0.3s; font-size:0.9rem; margin:3px; }
  .budget-section button:hover{ background:#ff6a00; }

  .comment-section { padding:20px; margin-top:20px; background:#fff8f1; border-top:3px solid #ff914d; border-radius:12px; }
  .comment-section h2 { color:#ff6a00; margin-bottom:10px; }
  #commentForm { display:flex; flex-direction:column; gap:10px; margin-bottom:20px; }
  #commentForm input { padding:10px; border-radius:6px; border:1px solid #ccc; width:100%; }
  #commentForm button { padding:10px; background:#ff914d; color:#fff; border:none; border-radius:6px; cursor:pointer; }
  #commentForm button:hover { background:#ff6a00; }
  .comment-card { background:#fff; padding:12px; border-radius:8px; margin-bottom:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  .comment-card p { margin-bottom:6px; }
  .like-btn { margin-right:10px; cursor:pointer; padding:4px 8px; border-radius:6px; border:none; }
  .liked { background:#ffd6ba; }
  .disliked { background:#ccc; }

  footer { text-align:center; padding:15px; font-size:0.9rem; background:#fff8f1; color:#777; margin-top:20px; }
  @media (max-width:600px) { .meal-section { grid-template-columns:repeat(2,1fr); } }
</style>
</head>
<body>

<header>
 <div>
  <h1 id="welcomeUser">Welcome to Campus Bite üçΩÔ∏è</h1>
  <p class="subtitle">Plan your meals, save your budget.</p>
 </div>
 <button id="logoutBtn">Logout</button>
</header>

<section class="filter-section">
  <label for="categoryFilter">Filter by Category:</label>
  <select id="categoryFilter">
    <option value="All">All</option>
    <option value="Breakfast">Breakfast</option>
    <option value="Lunch">Lunch</option>
    <option value="Drink">Drinks</option>
  </select>

  <label for="dayFilter">Filter by Day:</label>
  <select id="dayFilter">
    <option value="All">All Days</option>
    <option value="Monday">Monday</option>
    <option value="Tuesday">Tuesday</option>
    <option value="Wednesday">Wednesday</option>
    <option value="Thursday">Thursday</option>
    <option value="Friday">Friday</option>
    <option value="Saturday">Saturday</option>
    <option value="Sunday">Sunday</option>
  </select>
</section>

<section class="meal-section" id="mealSection"></section>

<section class="budget-section">
  <h2>Budget Plan</h2>
  <p id="budgetTotal">UGX 0</p>
  <button onclick="resetBudget()">Reset Budget</button>
  <button onclick="viewBudget()">View Added Items</button>
</section>

<section class="comment-section">
  <h2>Comments</h2>
  <form id="commentForm">
    <input type="text" id="commentInput" placeholder="Write a comment..." required />
    <button type="submit">Post Comment</button>
  </form>
  <div id="commentsContainer"></div>
</section>

<footer>¬© 2025 Campus Bite. All rights reserved.<br>Muni University | Arua Uganda</footer>

<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyATGWLqyjWJUaDXwudubIc_Hvh5yPVDyOI",
    authDomain: "campus-bite-9dbaa.firebaseapp.com",
    projectId: "campus-bite-9dbaa",
    storageBucket: "campus-bite-9dbaa.appspot.com",
    messagingSenderId: "294389261625",
    appId: "1:294389261625:web:095d6e5f85f4e8"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // --------------- USER AUTH ----------------
  let totalBudget = 0;
  let addedMeals = [];
  let currentUserName = "";

  auth.onAuthStateChanged(user=>{
    if(!user) window.location.href="index.html";
    else {
      db.collection("students").doc(user.uid).get().then(doc=>{
        if(doc.exists){
          const data = doc.data();
          document.getElementById("welcomeUser").textContent = `Welcome, ${data.name} üçΩÔ∏è`;
          currentUserName = data.name;
        }
      });
    }
  });

  document.getElementById("logoutBtn").addEventListener("click", async ()=>{
    await auth.signOut();
    window.location.href="index.html";
  });

  // --------------- MEALS -----------------
  const mealSection = document.getElementById("mealSection");
  const categoryFilter = document.getElementById("categoryFilter");
  const dayFilter = document.getElementById("dayFilter");

  const meals = [
    {name:"Mandazi", category:"Breakfast", place:"Campus Canteen", price:500, img:"images/mandazi.png"},
  {name:"Chapati", category:"Breakfast", place:"Campus Canteen", price:500, img:"images/chapati.jpg"},
  {name:"Fried Cassava", category:"Breakfast", place:"Cassava Lady", price:100, img:"images/fried cassava.jpg"},
  {name:"Pan Cakes", category:"Breakfast", place:"Cassava Lady", price:100, img:"images/pancakes.png"},
  {name:"Samosas", category:"Breakfast", place:"Munisite Market", price:200, img:"images/samosa.jpg"},
  {name:"Boiled Eggs", category:"Breakfast", place:"Campus Canteen", price:500, img:"images/eggs.jpg"},
  {name:"Black Tea", category:"Breakfast", place:"Cassava Lady", price:500, img:"images/tea.webp"},
  /*{name:"Fried Eggs & Toast", category:"Breakfast", place:"Caf√© Bliss", price:4000, img:"images/breakfast/eggs.jpg"},
  {name:"Breakfast Burrito", category:"Breakfast", place:"Taste Hub", price:5500, img:"images/breakfast/burrito.jpg"},
  {name:"Waffles", category:"Breakfast", place:"Morning Caf√©", price:5000, img:"images/breakfast/waffles.jpg"},*/
  {name:"Kikomando", category:"Lunch", place:"Campus Canteen", price:1000, img:"images/kikomando.jpg"},
  {name:"Fried Rice", category:"Lunch", place:"Desert breeze", price:2000, img:"images/rice.webp"},
  {name:"Matooke", category:"Lunch", place:"Cassava Lady", price:2000, img:"images/matooke.jpg"},
  {name:"White Rice & Beans", category:"Lunch", place:"Cassava Lady", price:2000, img:"images/white rice.jpg"},
  {name:"Anyoya", category:"Lunch", place:"Cassava Lady", price:1000, img:"images/anyoya.jpeg"},
  /*{name:"Burger Combo", category:"Lunch", place:"Campus Diner", price:10000, img:"images/lunch/burger.jpg"},
  {name:"Chicken Wrap", category:"Lunch", place:"Food Express", price:7000, img:"images/lunch/wrap.jpg"},
  {name:"Veggie Sandwich", category:"Lunch", place:"Fresh Spot", price:6500, img:"images/lunch/sandwich.jpg"},
  {name:"Grilled Fish", category:"Lunch", place:"Caf√© Bliss", price:13000, img:"images/lunch/grilledfish.jpg"},
  {name:"Chicken Salad", category:"Lunch", place:"Green Bowl", price:8000, img:"images/lunch/salad.jpg"},
  {name:"Pizza Slice", category:"Lunch", place:"Pizza Stop", price:5000, img:"images/lunch/pizza.jpg"},
  {name:"Beef Tacos", category:"Lunch", place:"Food Truck", price:9000, img:"images/lunch/tacos.jpg"},
  {name:"Chicken Biryani", category:"Lunch", place:"Campus Kitchen", price:11000, img:"images/lunch/biryani.jpg"},
  {name:"Veggie Rice Bowl", category:"Lunch", place:"Green Bowl", price:7500, img:"images/lunch/ricebowl.jpg"},
  {name:"Beef Burger", category:"Lunch", place:"Food Court", price:10000, img:"images/lunch/beefburger.jpg"},*/
  {name:"Cold Water", category:"Drink", place:"Campus Canteen", price:500, img:"images/nivana.jpg"},
  {name:"Cold sodas", category:"Drink", place:"Campus Canteen", price:1000, img:"images/soda.jpg"},
  {name:"Bongo", category:"Drink", place:"Campus Canteen", price:1000, img:"images/bongo.jpg"},
  {name:"Guiness", category:"Drink", place:"Campus Ark", price:4500, img:"images/guiness.png"},
  {name:"Bond 7", category:"Drink", place:"Campus Ark", price:7500, img:"images/bond7.jpg"},
  {name:"Smirnoff", category:"Drink", place:"Campus Ark", price:4000, img:"images/smirnoff.jpg"},
  {name:"Club Pilsener", category:"Drink", place:"Campus Ark", price:3500, img:"images/club.webp"},
  {name:"Minute maid", category:"Drink", place:"Campus Ark", price:2500, img:"images/minute maid.webp"},
  {name:"Bushera", category:"Drink", place:"Campus Canteen", price:1000, img:"images/bushera.jpeg"},
  {name:"Oner", category:"Drink", place:"Campus Canteen", price:1000, img:"images/oner.jpeg"},
  {name:"Yorghurt", category:"Drink", place:"Campus Canteen", price:2000, img:"images/yorghurt.jpg"},
  {name:"Fresh Juice", category:"Drink", place:"Campus Canteen", price:1000, img:"images/juice.jpg"},
];

  function renderMeals(category="All", day="All") {
    mealSection.innerHTML = "";
    let allowedPlaces;
    if(["Saturday","Sunday"].includes(day)) allowedPlaces = ["Campus Ark","Campus Canteen"];
    else if(["Monday","Tuesday","Wednesday","Thursday","Friday"].includes(day)) allowedPlaces = null;
    else allowedPlaces = null;

    meals
      .filter(m => (category==="All" || m.category===category))
      .filter(m => !allowedPlaces || allowedPlaces.includes(m.place))
      .forEach(meal=>{
        const card = document.createElement("div");
        card.className = "meal-card";
        card.innerHTML = `
          <img src="${meal.img}" alt="${meal.name}">
          <div class="meal-info">
            <h3>${meal.name}</h3>
            <p>${meal.category} ‚Äì UGX ${meal.price.toLocaleString()}</p>
            <p><strong>Place:</strong> ${meal.place}</p>
            <button onclick="addToBudget('${meal.name}', ${meal.price})">Add to Budget</button>
          </div>
        `;
        mealSection.appendChild(card);
      });
  }

  categoryFilter.addEventListener("change", ()=>renderMeals(categoryFilter.value, dayFilter.value));
  dayFilter.addEventListener("change", ()=>renderMeals(categoryFilter.value, dayFilter.value));

  // --------------- BUDGET -----------------
  const budgetDisplay = document.getElementById("budgetTotal");
  function addToBudget(name, amount){
    totalBudget+=amount;
    addedMeals.push({name, amount});
    budgetDisplay.textContent = "UGX "+totalBudget.toLocaleString();
    alert(`${name} added to your budget!`);
  }
  function resetBudget(){ totalBudget=0; addedMeals=[]; budgetDisplay.textContent="UGX 0"; }
  function viewBudget(){
    if(addedMeals.length===0) return alert("No items added yet!");
    let summary="Your Planned Budget:\n\n";
    addedMeals.forEach(i=> summary+=`${i.name} - UGX ${i.amount}\n`);
    summary+=`\nTotal: UGX ${totalBudget.toLocaleString()}`;
    alert(summary);
  }

  renderMeals();

  // -------------------- COMMENTS --------------------
  const commentForm = document.getElementById("commentForm");
  const commentInput = document.getElementById("commentInput");
  const commentsContainer = document.getElementById("commentsContainer");

  // Post comment
  commentForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const commentText = commentInput.value.trim();
    if (!commentText) return;
    const user = auth.currentUser;
    if (!user) return alert("You must be logged in!");
    await db.collection("comments").add({
      userId: user.uid,
      userName: currentUserName,
      text: commentText,
      likes: [],
      dislikes: [],
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    commentInput.value = "";
  });

  // Render comments in real-time
  db.collection("comments").orderBy("createdAt", "desc").onSnapshot(snapshot => {
    commentsContainer.innerHTML = "";
    snapshot.docs.forEach(doc => {
      const data = doc.data();
      const commentId = doc.id;
      const userId = auth.currentUser ? auth.currentUser.uid : "";

      const liked = data.likes.includes(userId);
      const disliked = data.dislikes.includes(userId);

      const card = document.createElement("div");
      card.className = "comment-card";
      card.innerHTML = `
        <p><strong>${data.userName}</strong></p>
        <p>${data.text}</p>
        <p>
          <button class="like-btn ${liked ? 'liked' : ''}" onclick="toggleReaction('${commentId}', 'like')">
            üëç ${data.likes.length}
          </button>
          <button class="like-btn ${disliked ? 'disliked' : ''}" onclick="toggleReaction('${commentId}', 'dislike')">
            üëé ${data.dislikes.length}
          </button>
        </p>
      `;
      commentsContainer.appendChild(card);
    });
  });

  async function toggleReaction(commentId, type) {
    const user = auth.currentUser;
    if (!user) return;
    const docRef = db.collection("comments").doc(commentId);
    const docSnap = await docRef.get();
    if (!docSnap.exists) return;

    let { likes = [], dislikes = [] } = docSnap.data();
    const uid = user.uid;

    if (type === "like") {
      if (likes.includes(uid)) likes = likes.filter(id => id !== uid);
      else {
        likes.push(uid);
        dislikes = dislikes.filter(id => id !== uid);
      }
    } else if (type === "dislike") {
      if (dislikes.includes(uid)) dislikes = dislikes.filter(id => id !== uid);
      else {
        dislikes.push(uid);
        likes = likes.filter(id => id !== uid);
      }
    }

    await docRef.update({ likes, dislikes });
  }
</script>
</body>
</html>
