<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Campus Bite ‚Äì Meals & Budget</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<meta name="theme-color" content="#ff914d">
 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins", sans-serif; }
body { background:#fff8f1; color:#333; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
header { background:#ff914d; color:#fff; padding:20px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 4px 8px rgba(0,0,0,0.1); position:relative;}
header h1 { font-size:1.3rem; font-weight:600; }
.subtitle { font-size:0.85rem; opacity:0.95; }
.profile-icon{width:40px;height:40px;background:#ff6b35;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:18px;text-decoration:none;transition:background .2s,transform .2s}
.profile-icon:hover{background:#e85d2f;transform:scale(1.1)}
.floating-comments{position:fixed;bottom:20px;right:20px;width:55px;height:55px;background:#ff6b35;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:22px;text-decoration:none;box-shadow:0 4px 12px rgba(0,0,0,.25);z-index:1000;transition:transform .2s,box-shadow .2s}
.floating-comments:hover{transform:scale(1.1);box-shadow:0 6px 18px rgba(0,0,0,.35)}
.options-btn { background:transparent; border:none; color:#fff; font-size:22px; cursor:pointer; padding:8px; border-radius:8px; }
.options-dropdown { position:absolute; right:20px; top:64px; background:#fff; color:#333; border-radius:8px; box-shadow:0 8px 20px rgba(0,0,0,0.15); padding:8px 0; min-width:180px; display:none; z-index:200; }
.options-dropdown a, .options-dropdown button.option-link { display:block; padding:10px 14px; text-decoration:none; color:inherit; border:none; background:none; text-align:left; width:100%; cursor:pointer; }
.options-dropdown a:hover, .options-dropdown button.option-link:hover { background:#fff0e6; color:#ff6a00; }
.filter-section { padding:15px 20px; display:flex; flex-wrap:wrap; align-items:center; gap:10px; }
.filter-section label { font-weight:600; }
.filter-section select { padding:5px 8px; border-radius:5px; }
.meal-section { padding:20px; display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; }
.meal-card { background:#fff; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.06); overflow:hidden; transition:transform .22s ease, box-shadow .22s ease; cursor:pointer; }
.meal-card:hover { transform:translateY(-6px); box-shadow:0 14px 30px rgba(0,0,0,0.08); }
.meal-card img { width:100%; height:150px; object-fit:cover; display:block; }
.meal-info { padding:14px; }
.meal-info h3 { color:#ff6a00; margin-bottom:6px; font-size:1.05rem; cursor:pointer; }
.meal-info p { font-size:0.9rem; margin-bottom:8px; color:#444; }
.meal-place { font-size:0.85rem; color:#666; margin-bottom:10px; }
.add-control { display:flex; align-items:center; gap:8px; }
.add-btn { background:#ff914d; color:#fff; border:none; border-radius:8px; padding:8px 12px; cursor:pointer; font-weight:600; transition:background .18s; }
.add-btn:hover { background:#ff6a00; }
.counter { display:inline-flex; align-items:center; background:#fff3ea; border-radius:8px; overflow:hidden; border:1px solid rgba(0,0,0,0.04); }
.counter button { background:transparent; border:none; padding:6px 10px; cursor:pointer; font-weight:700; font-size:1rem; color:#ff6a00; }
.counter span { padding:0 10px; min-width:26px; text-align:center; font-weight:700; color:#333; }
.budget-section { background:#fff0e6; padding:20px; text-align:center; border-top:3px solid #ff914d; margin-top:20px; }
.budget-section h2 { color:#ff6a00; margin-bottom:8px; }
.budget-section p { font-size:1rem; margin-bottom:8px; }
.budget-section button { background:#ff914d; color:#fff; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; transition:0.3s; font-size:0.9rem; margin:3px; }
.budget-section button:hover{ background:#ff6a00; }
footer { text-align:center; padding:15px; font-size:0.9rem; background:#fff8f1; color:#777; margin-top:20px; }
@media (max-width:600px) { .meal-section { grid-template-columns:repeat(2,1fr); } .options-dropdown { right:10px; left:auto; } }

.add-flash {
 animation : pop 0.35s ease;
}
@keyframes pop {
 0% { transform: scale(1); }
 40% { transform: scale(1.25); }
 100% { transform: scale(1); }
} 
.floating-budget {
  position: fixed;
  bottom: 90px; /* above comments button */
  right: 20px;
  width: 55px;
  height: 55px;
  background: #ff914d;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 20px;
  text-decoration: none;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  transition: transform 0.2s, box-shadow 0.2s;
  z-index: 1000;
}
.floating-budget:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 18px rgba(0,0,0,0.35);
}

</style>
</head>
<body>

<header>
 <div>
  <h1 id="welcomeUser">Welcome to Campus Bite üçΩÔ∏è</h1>
  <p class="subtitle">Plan your meals, save your budget.</p>
  </div>
 <div class="header-icons">
        <a href="profile.html" class="profile-icon">
            <i class="fa-solid fa-user"></i>
        </a>
    </div>
</header>

<section class="filter-section">
  <label for="categoryFilter">Filter by Category:</label>
  <select id="categoryFilter">
    <option value="All">All</option>
    <option value="Breakfast">Breakfast</option>
    <option value="Lunch">Lunch</option>
    <option value="Drink">Drinks</option>
  </select>

  <label for="dayFilter">Filter by Day:</label>
  <select id="dayFilter">
    <option value="All">All Days</option>
    <option value="Monday">Monday</option>
    <option value="Tuesday">Tuesday</option>
    <option value="Wednesday">Wednesday</option>
    <option value="Thursday">Thursday</option>
    <option value="Friday">Friday</option>
    <option value="Saturday">Saturday</option>
    <option value="Sunday">Sunday</option>
  </select>
</section>

<section class="meal-section" id="mealSection"></section>

<section class="budget-section">
  <h2>Budget Plan</h2>
  <p id="budgetTotal">UGX 0</p>
  <button onclick="resetBudget()">Reset Budget</button>
  <button onclick="viewBudget()">View Added Items</button>
</section>
<!-- comments button -->
<a href="comments.html" class="floating-comments">
    <i class="fa-solid fa-comment-dots"></i>
</a>
<!-- budget button -->
<a href="budget.html" class="floating-budget">
  <i class="fa-solid fa-wallet"></i></a>



<footer>¬© 2025 Campus Bite. All rights reserved.<br>Muni University | Arua Uganda<br>
  <b>For inquiries:+256748372023</b></footer>

<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

<script>
// ---------- Firebase ----------
const firebaseConfig = {
  apiKey: "AIzaSyATGWLqyjWJUaDXwudubIc_Hvh5yPVDyOI",
  authDomain: "campus-bite-9dbaa.firebaseapp.com",
  projectId: "campus-bite-9dbaa",
  storageBucket: "campus-bite-9dbaa.appspot.com",
  messagingSenderId: "294389261625",
  appId: "1:294389261625:web:095d6e5f85f4e8"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ---------- Local storage ----------
const STORAGE_KEY = "campusbite_budget_items_v1";
let totalBudget = 0;
let addedMeals = {};
let currentUserName = "";

function loadFromStorage(){
  try { const raw = localStorage.getItem(STORAGE_KEY); addedMeals = raw ? JSON.parse(raw) : {}; }
  catch(e){ addedMeals = {}; }
  totalBudget=0;
  Object.values(addedMeals).forEach(i=>{totalBudget+=(i.price*i.qty);});
  updateBudgetDisplay();
  Object.keys(addedMeals).forEach(name => {
  if(!addedMeals[name].img){
    const meal = meals.find(m => m.name === name);
    if(meal) addedMeals[name].img = meal.img;
  }
});
saveToStorage();

}
function saveToStorage(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(addedMeals)); }
function updateBudgetDisplay(){ document.getElementById("budgetTotal").textContent="UGX "+totalBudget.toLocaleString(); }

// ---------- Auth ----------
auth.onAuthStateChanged(user=>{
  if(!user){ window.location.href="index.html"; }
  else db.collection("students").doc(user.uid).get().then(doc=>{
    if(doc.exists){ currentUserName=doc.data().name; document.getElementById("welcomeUser").textContent=`Welcome, ${currentUserName} üçΩÔ∏è`; }
  });
});
// ---------- Meals ----------
const mealSection=document.getElementById("mealSection");
const categoryFilter=document.getElementById("categoryFilter");
const dayFilter=document.getElementById("dayFilter");

const meals=[
  {name:"Mandazi", category:"Breakfast", place:"Campus Canteen", price:500, img:"images/mandazi.png"},
  {name:"Chapati", category:"Breakfast", place:"Campus Canteen", price:500, img:"images/chapati.jpg"},
  {name:"Fried Cassava", category:"Breakfast", place:"Bangri TC", price:100, img:"images/fried cassava.jpg"},
  {name:"Pan Cakes", category:"Breakfast", place:"Bangri TC", price:100, img:"images/pancakes.png"},
  {name:"Samosas", category:"Breakfast", place:"Munisite Market", price:200, img:"images/samosa.jpg"},
  {name:"Boiled Eggs", category:"Breakfast", place:"Campus Canteen", price:500, img:"images/eggs.jpg"},
  {name:"Black Tea", category:"Breakfast", place:"Bangri TC", price:500, img:"images/tea.webp"},
  {name:"Toasted Bread", category:"Breakfast", place:"Desert Breeze", price:1000, img:"images/Bread.jpg"},
  {name:"Vegetable Samosa (A pair)", category:"Breakfast", place:"Desert Breeze", price:1000, img:"images/vegetable.jpg"},
  {name:"Beef Samosa(A pair)", category:"Breakfast", place:"Desert Breeze", price:1000, img:"images/beef.png"},
  {name:"Mandazi (A pair)", category:"Breakfast", place:"Desert Breeze", price:1500, img:"images/mandazi.jpg"},
  {name:"Beef Pie", category:"Breakfast", place:"Desert Breeze", price:4000, img:"images/beef pie.jpg"},
  {name:"Cookies", category:"Breakfast", place:"Desert Breeze", price:3000, img:"images/cookies.webp"},
  {name:"Home fries", category:"Breakfast", place:"Desert Breeze", price:3000, img:"images/fries.jpg"},
  {name:"Baked Beans", category:"Breakfast", place:"Desert Breeze", price:3000, img:"images/beans.jpg"},
  {name:"Egg Rolls (A pair)", category:"Breakfast", place:"Desert Breeze", price:3000, img:"images/egg rolls.jpg"},
  {name:"American Pancake", category:"Breakfast", place:"Desert Breeze", price:4000, img:"images/american.jpg"},
  {name:"Kikomando", category:"Lunch", place:"Campus Canteen", price:1000, img:"images/kikomando.jpg"},
  {name:"Fried Rice", category:"Lunch", place:"Desert breeze", price:2000, img:"images/rice.webp"},
  {name:"Matooke", category:"Lunch", place:"Bangri TC", price:2000, img:"images/matooke.jpg"},
  {name:"Beef Suasage (A pair)", category:"Breakfast", place:"Desert Breeze", price:3000, img:"images/beefs.webp"},
  {name:"White Rice & Beans", category:"Lunch", place:"Bangri TC", price:2000, img:"images/white rice.jpg"},
  {name:"Anyoya", category:"Lunch", place:"Bangri TC", price:1000, img:"images/anyoya.jpeg"},
  {name:"Chicken/Liver/Goat/Beef Stew", category:"Lunch", place:"Desert Breeze", price:10000, img:"images/chicken stew.jpg"},
  {name:"Chicken/Beef/Fish stew", category:"Lunch", place:"Munisite Restaurant", price:5000, img:"images/stew.webp"},
  {name:"Chicken/Beef Pizza", category:"Lunch", place:"Desert Breeze", price:15000, img:"images/pizza.jpg"},
  {name:"Chicken/Beef/Fish/Beans/G.nuts", category:"Lunch", place:"Bariffa Restaurant", price:6000, img:"images/g.nuts.jpg"},
  {name:"Matooke/Karo/Posho/Sweet Potatoes", category:"Lunch", place:"Bariffa Restaurant", price:3000, img:"images/foods.jpg"},
  {name:"Enyasa/Posho/Yams/Sweet & Irish Potatoes", category:"Lunch", place:"Muni site Restaurant", price:3000, img:"images/enyasa.jpg"},
  {name:"Greens/Peas", category:"Lunch", place:"Bariffa Restaurant", price:1500, img:"images/greens.jpg"},
  {name:"Roasted G.nuts", category:"Breakfast", place:"Campus Ark", price:500, img:"images/g.nuts.webp"},
  {name:"Fruit salad", category:"Lunch", place:"Desert Breeze", price:8000, img:"images/fruit.webp"},
  {name:"English Tea", category:"Breakfast", place:"Desert Breeze", price:5000, img:"images/english.jpg"},
  {name:"Hot Chocolate", category:"Breakfast", place:"Desert Breeze", price:5000, img:"images/chocolate.webp"},
  {name:"Cold Water", category:"Drink", place:"Campus Canteen", price:500, img:"images/nivana.jpg"},
  {name:"Cold sodas", category:"Drink", place:"Campus Canteen", price:1000, img:"images/soda.jpg"},
  {name:"Bongo", category:"Drink", place:"Campus Canteen", price:1000, img:"images/bongo.jpg"},
  {name:"Guiness", category:"Drink", place:"Campus Ark", price:4500, img:"images/guiness.png"},
  {name:"Bond 7", category:"Drink", place:"Campus Ark", price:7500, img:"images/bond7.jpg"},
  {name:"Smirnoff", category:"Drink", place:"Campus Ark", price:4000, img:"images/smirnoff.jpg"},
  {name:"Club Pilsener", category:"Drink", place:"Campus Ark", price:3500, img:"images/club.webp"},
  {name:"Minute maid", category:"Drink", place:"Campus Ark", price:2500, img:"images/minute maid.webp"},
  {name:"Bushera", category:"Drink", place:"Campus Canteen", price:1000, img:"images/bushera.jpeg"},
  {name:"Oner", category:"Drink", place:"Campus Canteen", price:1000, img:"images/oner.jpeg"},
  {name:"Yorghurt", category:"Drink", place:"Campus Canteen", price:2000, img:"images/yorghurt.jpg"},
  {name:"Fresh Juice", category:"Drink", place:"Desert Breeze", price:1000, img:"images/juice.jpg"}
];

// ---------- Render meals ----------
function renderMeals(category="All", day="All"){
  mealSection.innerHTML="";
  meals
    .filter(m => (category==="All" || m.category===category))
    .forEach(meal=>{
      const card=document.createElement("div");
      card.className="meal-card";

      const key=meal.name;
      const existing=addedMeals[key]?addedMeals[key].qty:0;

      let addControlHtml="";
      if(existing===1 ){
        addControlHtml=`<div class="add-control">
          <div class="counter" data-meal="${escapeHtml(meal.name)}">
            <button class="decrease">‚àí</button>
            <span class="qty">${existing}</span>
            <button class="increase">+</button>
          </div>
        </div>`;
      } else addControlHtml=`<div class="add-control"><button class="add-btn" data-meal="${escapeHtml(meal.name)}" data-price="${meal.price}">Add to Budget</button></div>`;

      card.innerHTML=`
        <img src="${meal.img}" alt="${meal.name}">
        <div class="meal-info">
          <h3 data-meal-link="${escapeHtml(meal.name)}">${meal.name}</h3>
          <p class="meal-place">${meal.place}</p>
          <p>${meal.category} ‚Äì UGX ${meal.price.toLocaleString()}</p>
          ${addControlHtml}
        </div>
      `;
      mealSection.appendChild(card);
    });

  attachAddControls();
  attachMealLinks();
}

function escapeHtml(str){ return (str+"").replace(/"/g,"&quot;").replace(/'/g,"&#39;"); }

// ---------- Add to budget ----------
function attachAddControls(){
  document.querySelectorAll(".add-btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const mealName=btn.getAttribute("data-meal");
      const price=Number(btn.getAttribute("data-price"));
      setMealQty(mealName, price, 1);

      // Flash animation
      btn.classList.add("add-flash");
      setTimeout(()=> btn.classList.remove("add-flash"), 350);
      
      renderMeals(categoryFilter.value, dayFilter.value);
      //alert(`${mealName} added to your budget!`);
    });
  });

  document.querySelectorAll(".counter").forEach(counter=>{
    const mealName=counter.getAttribute("data-meal");
    const inc=counter.querySelector(".increase");
    const dec=counter.querySelector(".decrease");
    const qtySpan=counter.querySelector(".qty");

    inc && inc.addEventListener("click", ()=>{
      const current=Number(qtySpan.textContent)
      const meal = meals.find(m => m.name === mealName);
const price = meal ? meal.price : 0;

      setMealQty(mealName, price, current+1);
      qtySpan.textContent=(addedMeals[mealName]&&addedMeals[mealName].qty)||0;
      updateBudgetDisplay();
    });

    dec && dec.addEventListener("click", ()=>{
      const current=Number(qtySpan.textContent)||0;
      const meal = meals.find(m => m.name === mealName);
const price = meal ? meal.price : 0;

      setMealQty(mealName, price, Math.max(0, current-1));
      if(addedMeals[mealName]&&addedMeals[mealName].qty===0){ delete addedMeals[mealName]; saveToStorage(); renderMeals(categoryFilter.value, dayFilter.value); }
      else qtySpan.textContent=(addedMeals[mealName]&&addedMeals[mealName].qty)||0;
      updateBudgetDisplay();
    });
  });
}

function findMealPrice(name){ const m=meals.find(x=>x.name===name); return m?m.price:0; }
function setMealQty(name, price, qty){
  const meal = meals.find(m => m.name === name);

  if(qty <= 0){
    delete addedMeals[name];
  } else {
    addedMeals[name] = {
      price: price,
      qty: qty,
      img: meal ? meal.img : ""
    };
  }

  totalBudget = 0;
  Object.values(addedMeals).forEach(i => {
    totalBudget += i.price * i.qty;
  });

  saveToStorage();
  updateBudgetDisplay();
}

// ---------- Filters ----------
categoryFilter.addEventListener("change", ()=>renderMeals(categoryFilter.value, dayFilter.value));
dayFilter.addEventListener("change", ()=>renderMeals(categoryFilter.value, dayFilter.value));

// ---------- Budget helpers ----------
function resetBudget(){ totalBudget=0; addedMeals={}; saveToStorage(); updateBudgetDisplay(); renderMeals(categoryFilter.value, dayFilter.value); }
function viewBudget(){ window.location.href = "budget.html";}

// ---------- Meal links ----------
function attachMealLinks(){
  document.querySelectorAll("[data-meal-link]").forEach(el=>{
    el.addEventListener("click", ()=>{ const mealName=el.getAttribute("data-meal-link"); window.location.href=`ingredients.html?meal=${encodeURIComponent(mealName)}`; });
  });
}

// ---------- Initialize ----------
loadFromStorage();
renderMeals();

window.resetBudget=resetBudget;
window.viewBudget=viewBudget;
window.addToBudget=function(name,price){ setMealQty(name, price, (addedMeals[name]?addedMeals[name].qty:0)+1); renderMeals(categoryFilter.value, dayFilter.value); };
</script>

</body>
</html>
