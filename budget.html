<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<title>Your Budget Plan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  font-family:Poppins,sans-serif;
  background:#fff8f1;
  padding:20px;
}
h1{
  color:#ff6a00;
  margin-bottom:15px;
}

/* Item card */
.budget-item{
  background:#fff;
  padding:12px;
  margin:12px 0;
  border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  display:flex;
  gap:12px;
  align-items:center;
}

/* Image */
.item-img{
  width:80px;
  height:80px;
  border-radius:12px;
  object-fit:cover;
  flex-shrink:0;
  background:#eee;
}

/* Info */
.item-info{
  flex:1;
}
.item-name{
  font-weight:600;
  margin-bottom:4px;
}
.item-price{
  font-size:.85rem;
  color:#666;
}

/* Quantity */
.qty-control{
  display:flex;
  align-items:center;
  gap:10px;
  margin-top:8px;
}
.qty-control button{
  width:32px;
  height:32px;
  border:none;
  border-radius:8px;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
  background:#ff914d;
  color:#fff;
}
.qty-control button:hover{background:#ff6a00}
.qty-control span{
  min-width:24px;
  text-align:center;
  font-weight:600;
}

.subtotal{
  margin-top:6px;
  font-weight:600;
  font-size:.9rem;
}

.total{
  margin-top:20px;
  font-size:1.3rem;
  font-weight:600;
  color:#ff6a00;
}

/* Buttons */
.button-row{
  display:flex;
  gap:10px;
  margin-top:25px;
}
.button-row button{
  flex:1;
  padding:12px;
  font-weight:600;
  border-radius:10px;
  cursor:pointer;
  font-size:1rem;
  border:none;
  transition:.2s;
}
.button-row button:hover{transform:scale(1.05)}
.btn-back{background:#ff914d;color:#fff}
.btn-order{background:#4CAF50;color:#fff}
button:disabled{opacity:.6;cursor:not-allowed}

/* Modal */
.modal{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,.5);
  z-index:999;
}
.modal.hidden{display:none}
.modal-content{
  background:#fff;
  padding:20px;
  border-radius:14px;
  width:85%;
  max-width:400px;
  text-align:center;
  animation:pop .25s ease;
}
.modal-actions{
  display:flex;
  justify-content:space-around;
  margin-top:15px;
}
.modal-actions button{
  padding:10px 18px;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
}
.yes{background:#4CAF50;color:#fff}
.no{background:#E53935;color:#fff}

@keyframes pop{
  from{transform:scale(.8);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
</head>

<body>

<h1>Your Budget Items</h1>

<div id="budgetList"></div>
<p class="total" id="grandTotal"></p>

<div class="button-row">
  <button id="backBtn" class="btn-back">← Back to add more</button>
  <button id="orderBtn" class="btn-order">Proceed to Checkout ✅</button>
</div>

<!-- Modal -->
<div id="confirmModal" class="modal hidden">
  <div class="modal-content">
    <p id="confirmMessage">Are you sure?</p>
    <div class="modal-actions">
      <button id="confirmYes" class="yes">Yes</button>
      <button id="confirmNo" class="no">No</button>
    </div>
  </div>
</div>

<script>
const STORAGE_KEY = "campusbite_budget_items_v1";
const PLACEHOLDER_IMG = "images/placeholder.png"; // add this image

function loadBudget(){
  const raw = localStorage.getItem(STORAGE_KEY);
  const items = raw ? JSON.parse(raw) : {};
  const list = document.getElementById("budgetList");
  let total = 0;

  list.innerHTML = "";

  if(Object.keys(items).length === 0){
    list.innerHTML = "<p>Your budget is empty. Add meals from home.</p>";
    document.getElementById("grandTotal").textContent = "";
    document.getElementById("orderBtn").disabled = true;
    return;
  }

  document.getElementById("orderBtn").disabled = false;

  Object.keys(items).forEach(name=>{
    const item = items[name];
    const sub = item.qty * item.price;
    total += sub;

    const img = item.img || PLACEHOLDER_IMG;

    const div = document.createElement("div");
    div.className = "budget-item";
    div.innerHTML = `
      <img src="${img}" class="item-img" alt="${name}">
      <div class="item-info">
        <div class="item-name">${name}</div>
        <div class="item-price">UGX ${item.price.toLocaleString()}</div>

        <div class="qty-control">
          <button class="decrease" data-name="${name}">−</button>
          <span>${item.qty}</span>
          <button class="increase" data-name="${name}">+</button>
        </div>

        <div class="subtotal">Subtotal: UGX ${sub.toLocaleString()}</div>
      </div>
    `;
    list.appendChild(div);
  });

  document.getElementById("grandTotal").textContent =
    "Total: UGX " + total.toLocaleString();

  attachQtyHandlers(items);
}

function attachQtyHandlers(items){
  document.querySelectorAll(".increase").forEach(btn=>{
    btn.onclick=()=>{
      const name=btn.dataset.name;
      items[name].qty++;
      save(items);
    };
  });
  document.querySelectorAll(".decrease").forEach(btn=>{
    btn.onclick=()=>{
      const name=btn.dataset.name;
      items[name].qty--;
      if(items[name].qty<=0) delete items[name];
      save(items);
    };
  });
}

function save(items){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
  loadBudget();
}

function showConfirmation(msg){
  return new Promise(res=>{
    confirmMessage.textContent=msg;
    confirmModal.classList.remove("hidden");
    confirmYes.onclick=()=>{confirmModal.classList.add("hidden");res(true);}
    confirmNo.onclick=()=>{confirmModal.classList.add("hidden");res(false);}
  });
}

backBtn.onclick=async()=>{
  if(await showConfirmation("Go back to pick more items?")){
    location.href="home.html";
  }
};
orderBtn.onclick=async()=>{
  if(await showConfirmation("Proceed to checkout?")){
    location.href="confirm-order.html";
  }
};

loadBudget();
</script>

</body>
</html>
